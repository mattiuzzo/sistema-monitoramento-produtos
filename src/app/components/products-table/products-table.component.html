<!-- src/app/components/products-table/products-table.component.html -->

<section class="data-section">
  <div class="section-header" [ngClass]="sectionHeaderClass">
    <div class="section-title">
      <i [class]="sectionTitleIconClass"></i>
      <h2>{{ title }}</h2>
    </div>
    <div class="section-actions">
      <button class="btn-refresh" (click)="onRefreshClick()">
        <i class="fas fa-sync-alt" [ngClass]="{'rotate': loading}"></i>
      </button>
    </div>
  </div>
  <div class="table-wrapper">
    <table class="data-table">
      <thead>
        <!-- Cabeçalho da tabela para produtos bloqueados -->
        <tr *ngIf="type === 'blocked'">
          <th>Produto</th>
          <th>Descrição</th>
          <th>Bloqueio</th>
          <th>Tipo</th>
        </tr>
        <!-- Cabeçalho da tabela para produtos liberados -->
        <tr *ngIf="type === 'released'">
          <th>Produto</th>
          <th>Descrição</th>
          <th>Liberação</th>
        </tr>
      </thead>
      <tbody>
        <!-- Exibe spinner de carregamento se 'loading' for true -->
        <ng-container *ngIf="loading">
          <tr class="loading-row">
            <td [attr.colspan]="type === 'blocked' ? 6 : 5">
              <div class="loading-spinner">
                <i class="fas fa-spinner fa-spin"></i>
                <span>Carregando dados...</span>
              </div>
            </td>
          </tr>
        </ng-container>
        <!-- Exibe mensagem de estado vazio se não houver produtos e não estiver carregando -->
        <ng-container *ngIf="!loading && products.length === 0">
          <tr class="empty-state-row">
            <td [attr.colspan]="type === 'blocked' ? 6 : 5">
              <div class="empty-state">
                <i class="fas" [ngClass]="{'fa-check-circle': type === 'blocked', 'fa-inbox': type === 'released'}"></i>
                <div *ngIf="type === 'blocked'">Nenhum produto bloqueado no momento</div>
                <div *ngIf="type === 'released'">Nenhum produto liberado recentemente</div>
              </div>
            </td>
          </tr>
        </ng-container>
        <!-- Itera sobre os produtos se não estiver carregando e houver produtos -->
        <ng-container *ngIf="!loading && products.length > 0">
          <tr *ngFor="let product of products" class="fade-in">
            <!-- Renderiza colunas específicas para produtos bloqueados -->
            <ng-container *ngIf="isBlockedProduct(product)">
              <td><span class="code">{{ product.empresa }}-{{ product.codigo }}</span></td>
              <td><span class="code">{{ product.descricao }}</span></td>
              <td>{{ (product.dataBloq | dateFormat) + " | " + product.usuarioBloq }}</td>
              <div *ngIf="tpOrigem(product) === 'I'">
                <td><span class="badge inclusao">{{ product.origem.substring(0,1) }}</span></td>
              </div>
              <div *ngIf="tpOrigem(product) === 'A'">
                <td><span class="badge alteracao">{{ product.origem.substring(0,1) }}</span></td>
              </div>
            </ng-container>
            <!-- Renderiza colunas específicas para produtos liberados -->
            <ng-container *ngIf="isReleasedProduct(product)">
              <td><span class="code">{{ product.empresa }}-{{ product.codigo }}</span></td>
              <td><span class="code">{{ product.descricao.substring(0,20)}}</span></td>
              <td>{{ (product.dataLib | dateFormat) }} - {{ product.horaLib }} | {{ product.usuarioLib }} </td>
            </ng-container>
          </tr>
        </ng-container>
      </tbody>
    </table>
  </div>
</section>